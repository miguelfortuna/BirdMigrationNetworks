library("lme4")
library("MuMIn")
library("tidyverse")
overdisp_fun <- function(model) {
## number of variance parameters in
##   an n-by-n variance-covariance matrix
vpars <- function(m) {
nrow(m)*(nrow(m)+1)/2
}
model.df <- sum(sapply(VarCorr(model),vpars))+length(fixef(model))
rdf <- nrow(model.frame(model))-model.df
rp <- residuals(model,type="pearson")
Pearson.chisq <- sum(rp^2)
prat <- Pearson.chisq/rdf
pval <- pchisq(Pearson.chisq, df=rdf, lower.tail=FALSE)
c(chisq=Pearson.chisq,ratio=prat,rdf=rdf,p=pval)
}
### read data ----
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv") %>%
select(iba_label, species_name, is_flu)
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv")
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv") %>%
select(iba_label, species_name, is_flu)
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv")
head(data_flu)
data
### load required libraries ----
library("igraph")
library("mapproj")
library("tidyverse")
### read data ----
data <- read_csv("../working_data/links_84_species.csv")
species <- read_csv("../working_data/species_84.csv") %>% select(species_label, species_name)
ibas <- read_csv("../working_data/ibas_84_species.csv")
## function to compute the degree, strength and betweenness of the nodes of a network ----
comp_node_traits <- function(speciesName) {
speciesName <- speciesName
speciesNetwork <- str_replace(speciesName, "_", " ")
# read data
web <- inner_join(data, species, by = "species_label") %>%
filter(species_name == speciesNetwork) %>%
select(from, to, individuals) %>% rename(weight = individuals)
# from dataframe to igraph object
web_igraph <- graph_from_data_frame(web, directed = TRUE)
# compute degree and strength (as vectors)
degree_in <- degree(web_igraph, V(web_igraph), mode = "in")
strength_in <- strength(web_igraph, V(web_igraph), mode = "in")
# from vector to dataframe
degree_in <- rownames_to_column(as.data.frame(degree_in)) %>% rename("iba_label" = "rowname")
strength_in <- rownames_to_column(as.data.frame(strength_in)) %>% rename("iba_label" = "rowname")
# compute betweenness
betweenness <- as.data.frame(betweenness(web_igraph, V(web_igraph), directed = TRUE))
betweenness <- rownames_to_column(betweenness)
colnames(betweenness) <- c("iba_label", "betweenness")
df <- inner_join(
inner_join(
degree_in,
strength_in,
by = "iba_label"),
betweenness,
by = "iba_label") %>%
mutate(log.degree_in = log(degree_in + 1),
log.strength_in = log(strength_in + 1),
log.betweenness = log(betweenness + 1),
species_name = speciesName)
df
#write_csv(df, paste0("84_species_networks/", speciesName, ".csv"))
}
### compute degree, strength and betweenness of the nodes of the 84 species ----
data_list <- list()
species_84 <- species %>% distinct(species_name)
for(i in 1:nrow(species_84)) {
speciesN <- str_replace(species_84$species_name[i], " ", "_")
#comp_node_traits(speciesN)
data_list[[i]] <- comp_node_traits(speciesN)
print(speciesN)
}
data_84_species <- bind_rows(data_list)
data_84_species
PCA <- prcomp(data_84_species[c("log.degree_in", "log.strength_in", "log.betweenness")],
center = TRUE, scale = TRUE)
summary(PCA)
PC <- data.frame(PCA$x[,1], PCA$x[,2])
PC
data <- data_84_species %>%
mutate(pc1 = PCA$x[,1])
data
write.csv(data[,-1], "data_pc1.csv")
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv")
library("lme4")
library("MuMIn")
library("tidyverse")
overdisp_fun <- function(model) {
## number of variance parameters in
##   an n-by-n variance-covariance matrix
vpars <- function(m) {
nrow(m)*(nrow(m)+1)/2
}
model.df <- sum(sapply(VarCorr(model),vpars))+length(fixef(model))
rdf <- nrow(model.frame(model))-model.df
rp <- residuals(model,type="pearson")
Pearson.chisq <- sum(rp^2)
prat <- Pearson.chisq/rdf
pval <- pchisq(Pearson.chisq, df=rdf, lower.tail=FALSE)
c(chisq=Pearson.chisq,ratio=prat,rdf=rdf,p=pval)
}
data_flu <- read_csv("../pca_and_predictions/data_pc1.csv")
head(data_flu)
data <- read_csv("../pca_and_predictions/data_pc1.csv")
head(data)
data_flu <- read.csv("../avian_flu_data/flu_data_working.csv")
head(data_flu)
data_flu <- read.csv("../avian_flu_data/flu_data_working.csv") %>% mutate(is_flu=1)
head(data_flu)
data_flu <- read.csv("../avian_flu_data/flu_data_working.csv") %>% mutate(is_flu=1)
data <- read_csv("../pca_and_predictions/data_pc1.csv")
df <- left_join(data, data_flu, by = c("iba_label", "species_name")) %>%
mutate(is_flu = replace_na(is_flu, 0))
data_flu <- read.csv("../avian_flu_data/flu_data_working.csv") %>% mutate(is_flu=1)
data <- read_csv("../pca_and_predictions/data_pc1.csv")
head(data)
head(data_flu)
df <- left_join(data, data_flu, by = c("iba_label", "species_name"))
head(df)
flu_incidence <- inner_join(data_flu %>%
group_by(species_name) %>%
summarise(n = n()),
data_flu %>% filter(is_flu == 1) %>%
group_by(species_name) %>%
summarise(n_flu = n()),
by = "species_name") %>%
arrange(desc(n_flu))
flu_incidence
df
