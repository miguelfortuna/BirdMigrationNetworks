### load required libraries ----
library("igraph")
library("mapproj")
library("tidyverse")
### read data ----
data <- read_csv("../working_data/links_84_species.csv")
species <- read_csv("../working_data/species_84.csv") %>% select(species_label, species_name)
ibas <- read_csv("../working_data/ibas_84_species.csv")
#write_csv(df, paste0("84_species_networks/", speciesName, ".csv"))
}
### function to compute the degree, strength and betweenness of the nodes of a network ----
comp_node_traits <- function(speciesName) {
speciesName <- speciesName
speciesNetwork <- str_replace(speciesName, "_", " ")
# read data
web <- inner_join(data, species, by = "species_label") %>%
filter(species_name == speciesNetwork) %>%
select(from, to, individuals) %>% rename(weight = individuals)
# from dataframe to igraph object
web_igraph <- graph_from_data_frame(web, directed = TRUE)
# compute degree and strength (as vectors)
degree_in <- degree(web_igraph, V(web_igraph), mode = "in")
strength_in <- strength(web_igraph, V(web_igraph), mode = "in")
# from vector to dataframe
degree_in <- rownames_to_column(as.data.frame(degree_in)) %>% rename("iba_label" = "rowname")
strength_in <- rownames_to_column(as.data.frame(strength_in)) %>% rename("iba_label" = "rowname")
# compute betweenness
betweenness <- as.data.frame(betweenness(web_igraph, V(web_igraph), directed = TRUE))
betweenness <- rownames_to_column(betweenness)
colnames(betweenness) <- c("iba_label", "betweenness")
df <- inner_join(
inner_join(
degree_in,
strength_in,
by = "iba_label"),
betweenness,
by = "iba_label") %>%
mutate(log.degree_in = log(degree_in + 1),
log.strength_in = log(strength_in + 1),
log.betweenness = log(betweenness + 1),
species_name = speciesName)
df
#write_csv(df, paste0("84_species_networks/", speciesName, ".csv"))
}
data_list <- list()
species_84 <- species %>% distinct(species_name)
for(i in 1:nrow(species_84)) {
speciesN <- str_replace(species_84$species_name[i], " ", "_")
#comp_node_traits(speciesN)
data_list[[i]] <- comp_node_traits(speciesN)
print(speciesN)
}
data_84_species <- bind_rows(data_list)
head(data_84_species)
PCA <- prcomp(data_84_species[c("log.degree_in", "log.strength_in", "log.betweenness")],
center = TRUE, scale = TRUE)
summary(PCA)
data <- data_84_species %>%
mutate(pc1 = PCA$x[,1])
data
summary(PCA)
write.csv(data, "data_pc1.csv")
df <- list()
for(i in 1:nrow(species)) {
speciesName <- str_replace(species$species_name[i], " ", "_")
top_10 <- data %>%
filter(species_name == speciesName) %>%
nrow * 0.1 # top 10%
df[[i]] <- data %>%
filter(species_name == speciesName) %>%
select(species_name, iba_label, pc1) %>%
arrange(pc1) %>%
head(round(top_10))
print(speciesName)
}
top_list <- bind_rows(df)
head(top_list)
